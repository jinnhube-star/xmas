<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Magic AI Christmas Tree</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.0/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        #status-bar { position: absolute; top: 20px; left: 20px; color: gold; font-size: 1.2rem; text-shadow: 0 0 10px gold; }
        #controls { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; pointer-events: all; }
        .magic-btn { background: rgba(255, 215, 0, 0.15); border: 2px solid gold; color: gold; padding: 15px 30px; border-radius: 50px; cursor: pointer; backdrop-filter: blur(15px); font-weight: bold; transition: 0.3s; }
        .magic-btn:hover { background: gold; color: black; box-shadow: 0 0 20px gold; }
        #v-preview { position: absolute; top: 10px; right: 10px; width: 180px; border: 2px solid gold; border-radius: 20px; transform: scaleX(-1); background: #111; }
        #startup-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #222, #000); display: flex; flex-direction: column; justify-content: center; align-items: center; color: gold; z-index: 9999; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div id="startup-screen">
    <h1>ðŸŽ„ Magical Memory Tree</h1>
    <button class="magic-btn" id="start-magic" style="font-size: 1.5rem;">CLICK TO START MAGIC</button>
    <p style="margin-top: 20px; opacity: 0.7;">Requires Camera & HTTPS for Gestures</p>
</div>

<div id="ui-overlay">
    <div id="status-bar">âœ¨ Tree is Resting...</div>
    <video id="v-preview" autoplay playsinline></video>
    <div id="controls">
        <label class="magic-btn" for="photo-in">ðŸ“¸ ADD PHOTO</label>
        <input type="file" id="photo-in" multiple accept="image/*">
        <label class="magic-btn" for="music-in">ðŸŽµ SET MUSIC</label>
        <input type="file" id="music-in" accept="audio/*">
    </div>
</div>

<audio id="player" loop crossorigin="anonymous"></audio>

<script>
/** 1. SUPABASE CONNECTION (Add your keys here) **/
const SB_URL = "https://fghbnkjpuoqonnqrtxlm.supabase.co"; 
const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZnaGJua2pwdW9xb25ucXJ0eGxtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1OTc1ODgsImV4cCI6MjA4MjE3MzU4OH0.LkPfFC19GKdQcP2IaZyrymxhF2bNzCwcw-yrjMKqOIw";
let db = null;
if (SB_URL !== "https://fghbnkjpuoqonnqrtxlm.supabase.co") db = supabase.createClient(SB_URL, SB_KEY);

/** 2. FANCY 3D SCENE (GLITTER TREE) **/
const scene = new THREE.Scene();
con
